<!DOCTYPE html>
       <html lang="zh-CN">
       <head>
           <meta charset="UTF-8">
           <meta name="viewport" content="width=device-width, initial-scale=1.0">
           <title>销售报告</title>
           <script src="https://cdn.tailwindcss.com"></script>
           <style>
               table { width: 100%; border: 1px solid gray; margin-bottom: 20px; }
               th, td { border: 1px solid gray; padding: 8px; text-align: center; }
               th { background-color: lightgray; }
               tr:hover { background-color: #f0f0f0; }
           </style>
       </head>
       <body style="background-color: #f5f5f5; font-family: Arial;">
           <div style="width: 80%; margin: 20px auto; padding: 20px; background-color: white; border-radius: 8px;">
               <h1 style="font-size: 24px; font-weight: bold; text-align: center;">一线城市电商销售报告</h1>
               <p style="color: gray; text-align: center;">数据来源：2024年电商数据</p>
               <h2 style="font-size: 20px; font-weight: bold;">数据表格</h2>
               <table id="salesTable">
                   <thead>
                       <tr>
                           <th>城市</th>
                           <th>产品类别</th>
                           <th>销售额 (元)</th>
                       </tr>
                   </thead>
                   <tbody></tbody>
               </table>
               <h2 style="font-size: 20px; font-weight: bold;">数据洞察</h2>
               <p id="totalInsight" style="color: gray;">加载中...</p>
               <h3 style="font-size: 18px; font-weight: bold; margin-top: 20px;">品类分析</h3>
               <ul id="categoryInsights" style="color: gray; list-style-type: disc; padding-left: 20px;"></ul>
               <h3 style="font-size: 18px; font-weight: bold; margin-top: 20px;">品类占比</h3>
               <ul id="categoryShares" style="color: gray; list-style-type: disc; padding-left: 20px;"></ul>
               <h3 style="font-size: 18px; font-weight: bold; margin-top: 20px;">关键总结</h3>
               <ul id="keySummary" style="color: gray; list-style-type: disc; padding-left: 20px;"></ul>
               <h3 style="font-size: 18px; font-weight: bold; margin-top: 20px;">下个季度应对策略</h3>
               <ul id="nextQuarterStrategies" style="color: gray; list-style-type: disc; padding-left: 20px;"></ul>
           </div>
           <script>
               fetch('data.csv')
                   .then(response => {
                       if (!response.ok) throw new Error('无法加载data.csv，检查文件是否存在');
                       return response.text();
                   })
                   .then(text => {
                       console.log('文件内容:', text);
                       const lines = text.trim().split('\n').slice(1);
                       const data = lines.map((line, index) => {
                           const parts = line.split(/[,;]/);
                           console.log('第' + (index + 1) + '行:', parts);
                           if (parts.length >= 3) {
                               return {
                                   city: parts[0].trim(),
                                   category: parts[1].trim(),
                                   sales: parseFloat(parts[2].trim())
                               };
                           }
                           return null;
                       }).filter(row => row && row.city && row.category && !isNaN(row.sales));
                       console.log('解析结果:', data);
                       const tbody = document.querySelector('#salesTable tbody');
                       tbody.innerHTML = '';
                       if (data.length === 0) {
                           document.getElementById('totalInsight').textContent = '数据不对，请检查data.csv格式（需逗号或分号分隔，无引号或空行）。';
                           return;
                       }
                       data.forEach(row => {
                           const tr = document.createElement('tr');
                           tr.innerHTML = `
                               <td style="border: 1px solid gray; padding: 8px;">${row.city}</td>
                               <td style="border: 1px solid gray; padding: 8px;">${row.category}</td>
                               <td style="border: 1px solid gray; padding: 8px;">${row.sales.toLocaleString('zh-CN')}</td>
                           `;
                           tbody.appendChild(tr);
                       });
                       const cityTotals = data.reduce((acc, item) => {
                           acc[item.city] = (acc[item.city] || 0) + item.sales;
                           return acc;
                       }, {});
                       const topCity = Object.entries(cityTotals).reduce(
                           (top, [city, sales]) => sales > top.sales ? { city, sales } : top,
                           { city: '', sales: 0 }
                       );
                       document.getElementById('totalInsight').textContent = 
                           topCity.city ? 
                           `${topCity.city}的销售额最高，总额${topCity.sales.toLocaleString('zh-CN')}元，主要是电子产品。` :
                           '没有有效数据';
                       const categoryTotals = data.reduce((acc, item) => {
                           const key = item.category;
                           if (!acc[key]) acc[key] = {};
                           acc[key][item.city] = (acc[key][item.city] || 0) + item.sales;
                           return acc;
                       }, {});
                       const categoryInsights = document.getElementById('categoryInsights');
                       categoryInsights.innerHTML = '';
                       Object.entries(categoryTotals).forEach(([category, cities]) => {
                           const topCity = Object.entries(cities).reduce(
                               (top, [city, sales]) => sales > top.sales ? { city, sales } : top,
                               { city: '', sales: 0 }
                           );
                           if (topCity.city) {
                               const li = document.createElement('li');
                               let preference = '';
                               if (category === '图书') {
                                   preference = '说明该城市消费者更爱读书';
                               } else if (category === '服装') {
                                   preference = '说明该城市消费者注重时尚';
                               } else if (category === '电子产品') {
                                   preference = '说明该城市消费者偏好科技产品';
                               } else {
                                   preference = '说明该城市消费者对该品类有较高需求';
                               }
                               li.textContent = `${category}：${topCity.city}最高，销售额${topCity.sales.toLocaleString('zh-CN')}元，${preference}。`;
                               categoryInsights.appendChild(li);
                           }
                       });
                       const totalSales = data.reduce((sum, item) => sum + item.sales, 0);
                       const categoryShares = data.reduce((acc, item) => {
                           acc[item.category] = (acc[item.category] || 0) + item.sales;
                           return acc;
                       }, {});
                       const categorySharesList = document.getElementById('categoryShares');
                       categorySharesList.innerHTML = '';
                       Object.entries(categoryShares).forEach(([category, sales]) => {
                           const percentage = (sales / totalSales * 100).toFixed(2);
                           const li = document.createElement('li');
                           li.textContent = `${category}：占总销售额${percentage}%，销售${sales.toLocaleString('zh-CN')}元。`;
                           categorySharesList.appendChild(li);
                       });
                       const keySummary = document.getElementById('keySummary');
                       keySummary.innerHTML = '';
                       const topCategory = Object.entries(categoryShares).reduce(
                           (top, [category, sales]) => sales > top.sales ? { category, sales } : top,
                           { category: '', sales: 0 }
                       );
                       [
                           `${topCity.city}总销售额最高，达${topCity.sales.toLocaleString('zh-CN')}元，${topCategory.category}贡献最大。`,
                           Object.keys(categoryTotals).map(category => {
                               const top = Object.entries(categoryTotals[category]).reduce(
                                   (t, [c, s]) => s > t[1] ? [c, s] : t,
                                   ['', 0]
                               );
                               return `${category}品类在${top[0]}表现最佳，销售${top[1].toLocaleString('zh-CN')}元。`;
                           }).join(' '),
                           `${topCategory.category}占总销售额${(topCategory.sales / totalSales * 100).toFixed(2)}%，显示科技产品需求旺盛。`
                       ].forEach(text => {
                           const li = document.createElement('li');
                           li.textContent = text;
                           keySummary.appendChild(li);
                       });
                       const nextQuarterStrategies = document.getElementById('nextQuarterStrategies');
                       nextQuarterStrategies.innerHTML = '';
                       [
                           `在${topCity.city}加大${topCategory.category}促销，推出新品或促销活动（如科技产品展示会）。`,
                           Object.keys(categoryTotals).map(category => {
                               const top = Object.entries(categoryTotals[category]).reduce(
                                   (t, [c, s]) => s > t[1] ? [c, s] : t,
                                   ['', 0]
                               );
                               let action = '';
                               if (category === '图书') action = '举办读书会或文学活动';
                               else if (category === '服装') action = '推出时尚发布会或折扣季';
                               else if (category === '电子产品') action = '增加新品库存并优化线上推广';
                               else action = '提升库存和营销活动';
                               return `在${top[0]}推广${category}，${action}。`;
                           }).join('|').split('|'),
                           `其他城市（如广州、深圳）增加${topCategory.category}库存，补齐市场短板。`
                       ].flat().forEach(text => {
                           const li = document.createElement('li');
                           li.textContent = text;
                           nextQuarterStrategies.appendChild(li);
                       });
                   })
                   .catch(error => {
                       document.getElementById('totalInsight').textContent = '加载失败，请确认data.csv已上传且格式正确。';
                       console.error('错误:', error);
                   });
           </script>
       </body>
       </html>
